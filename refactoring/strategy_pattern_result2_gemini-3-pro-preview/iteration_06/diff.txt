--- backup/classes\di_BindingParam.cls
+++ refactored/classes\di_BindingParam.cls
@@ -13,91 +13,20 @@
-if(valueinstanceofDecimal){
-DecimaldecimalValue=(Decimal)value;
-res.longValue=toLongValue(decimalValue);
-res.decimalValue=decimalValue;
-res.stringValue=toStringValue(decimalValue);
-res.booleanValue=toBooleanValue(decimalValue);
-res.dateValue=toDateValue(decimalValue);
-res.dateTimeValue=toDateTimeValue(decimalValue);
-}elseif(valueinstanceofDecimal[]){
-Decimal[]decimalValues=(Decimal[])value;
-res.decimalValues=decimalValues;
-for(DecimaldecimalValue:decimalValues){
-res.longValues.add(toLongValue(decimalValue));
-res.stringValues.add(toStringValue(decimalValue));
-res.booleanValues.add(toBooleanValue(decimalValue));
-res.dateValues.add(toDateValue(decimalValue));
-res.dateTimeValues.add(toDateTimeValue(decimalValue));
-}
-}elseif(valueinstanceofString){
-StringstringValue=(String)value;
-res.longValue=toLongValue(stringValue);
-res.decimalValue=toDecimalValue(stringValue);
-res.stringValue=stringValue;
-res.booleanValue=toBooleanValue(stringValue);
-res.dateValue=toDateValue(stringValue);
-res.dateTimeValue=toDateTimeValue(stringValue);
-}elseif(valueinstanceofString[]){
-String[]stringValues=(String[])value;
-res.stringValues=stringValues;
-for(StringstringValue:stringValues){
-res.longValues.add(toLongValue(stringValue));
-res.decimalValues.add(toDecimalValue(stringValue));
-res.booleanValues.add(toBooleanValue(stringValue));
-res.dateValues.add(toDateValue(stringValue));
-res.dateTimeValues.add(toDateTimeValue(stringValue));
-}
-}elseif(valueinstanceofBoolean){
-BooleanbooleanValue=(Boolean)value;
-res.longValue=toLongValue(booleanValue);
-res.decimalValue=toDecimalValue(booleanValue);
-res.stringValue=toStringValue(booleanValue);
-res.booleanValue=booleanValue;
-res.dateValue=toDateValue(booleanValue);
-res.dateTimeValue=toDateTimeValue(booleanValue);
-}elseif(valueinstanceofBoolean[]){
-Boolean[]booleanValues=(Boolean[])value;
-res.booleanValues=booleanValues;
-for(BooleanbooleanValue:booleanValues){
-res.longValues.add(toLongValue(booleanValue));
-res.decimalValues.add(toDecimalValue(booleanValue));
-res.stringValues.add(toStringValue(booleanValue));
-res.dateValues.add(toDateValue(booleanValue));
-res.dateTimeValues.add(toDateTimeValue(booleanValue));
-}
-}elseif(valueinstanceofDate){
-DatedateValue=(Date)value;
-res.longValue=toLongValue(dateValue);
-res.decimalValue=toDecimalValue(dateValue);
-res.stringValue=toStringValue(dateValue);
-res.booleanValue=toBooleanValue(dateValue);
-res.dateValue=dateValue;
-res.dateTimeValue=toDateTimeValue(dateValue);
-}elseif(valueinstanceofDate[]){
-Date[]dateValues=(Date[])value;
-res.dateValues=dateValues;
-for(DatedateValue:dateValues){
-res.longValues.add(toLongValue(dateValue));
-res.decimalValues.add(toDecimalValue(dateValue));
-res.stringValues.add(toStringValue(dateValue));
-res.booleanValues.add(toBooleanValue(dateValue));
-res.dateTimeValues.add(toDateTimeValue(dateValue));
-}
-}elseif(valueinstanceofDateTime){
-DateTimedateTimeValue=(DateTime)value;
-res.longValue=toLongValue(dateTimeValue);
-res.decimalValue=toDecimalValue(dateTimeValue);
-res.stringValue=toStringValue(dateTimeValue);
-res.booleanValue=toBooleanValue(dateTimeValue);
-res.dateValue=toDateValue(dateTimeValue);
-res.dateTimeValue=dateTimeValue;
-}elseif(valueinstanceofDateTime[]){
-DateTime[]dateTimeValues=(DateTime[])value;
-res.dateTimeValues=dateTimeValues;
-for(DateTimedateTimeValue:dateTimeValues){
-res.longValues.add(toLongValue(dateTimeValue));
-res.decimalValues.add(toDecimalValue(dateTimeValue));
-res.stringValues.add(toStringValue(dateTimeValue));
-res.booleanValues.add(toBooleanValue(dateTimeValue));
-res.dateValues.add(toDateValue(dateTimeValue));
-}
-}
+BindingParamStrategystrategy=getStrategy(value);
+if(strategy!=null){
+strategy.execute(value,res);
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")hasunknowntype');
+}
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
+}
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
+}
+finalizeResponse(res);
+System.debug('paramName='+req);
+System.debug(res);
+responses.add(res);
+}
+returnresponses;
+}
+privatestaticvoidfinalizeResponse(Responseres){
@@ -116,11 +45,136 @@
-}else{
-System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
-}
-}else{
-System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
-}
-System.debug('paramName='+req);
-System.debug(res);
-responses.add(res);
-}
-returnresponses;
+}
+privateinterfaceBindingParamStrategy{
+voidexecute(Objectvalue,Responseres);
+}
+privatestaticBindingParamStrategygetStrategy(Objectvalue){
+if(valueinstanceofDecimal)returnnewDecimalStrategy();
+if(valueinstanceofDecimal[])returnnewDecimalArrayStrategy();
+if(valueinstanceofString)returnnewStringStrategy();
+if(valueinstanceofString[])returnnewStringArrayStrategy();
+if(valueinstanceofBoolean)returnnewBooleanStrategy();
+if(valueinstanceofBoolean[])returnnewBooleanArrayStrategy();
+if(valueinstanceofDate)returnnewDateStrategy();
+if(valueinstanceofDate[])returnnewDateArrayStrategy();
+if(valueinstanceofDateTime)returnnewDateTimeStrategy();
+if(valueinstanceofDateTime[])returnnewDateTimeArrayStrategy();
+returnnull;
+}
+privateclassDecimalStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+DecimaldecimalValue=(Decimal)value;
+res.longValue=toLongValue(decimalValue);
+res.decimalValue=decimalValue;
+res.stringValue=toStringValue(decimalValue);
+res.booleanValue=toBooleanValue(decimalValue);
+res.dateValue=toDateValue(decimalValue);
+res.dateTimeValue=toDateTimeValue(decimalValue);
+}
+}
+privateclassDecimalArrayStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+Decimal[]decimalValues=(Decimal[])value;
+res.decimalValues=decimalValues;
+for(DecimaldecimalValue:decimalValues){
+res.longValues.add(toLongValue(decimalValue));
+res.stringValues.add(toStringValue(decimalValue));
+res.booleanValues.add(toBooleanValue(decimalValue));
+res.dateValues.add(toDateValue(decimalValue));
+res.dateTimeValues.add(toDateTimeValue(decimalValue));
+}
+}
+}
+privateclassStringStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+StringstringValue=(String)value;
+res.longValue=toLongValue(stringValue);
+res.decimalValue=toDecimalValue(stringValue);
+res.stringValue=stringValue;
+res.booleanValue=toBooleanValue(stringValue);
+res.dateValue=toDateValue(stringValue);
+res.dateTimeValue=toDateTimeValue(stringValue);
+}
+}
+privateclassStringArrayStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+String[]stringValues=(String[])value;
+res.stringValues=stringValues;
+for(StringstringValue:stringValues){
+res.longValues.add(toLongValue(stringValue));
+res.decimalValues.add(toDecimalValue(stringValue));
+res.booleanValues.add(toBooleanValue(stringValue));
+res.dateValues.add(toDateValue(stringValue));
+res.dateTimeValues.add(toDateTimeValue(stringValue));
+}
+}
+}
+privateclassBooleanStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+BooleanbooleanValue=(Boolean)value;
+res.longValue=toLongValue(booleanValue);
+res.decimalValue=toDecimalValue(booleanValue);
+res.stringValue=toStringValue(booleanValue);
+res.booleanValue=booleanValue;
+res.dateValue=toDateValue(booleanValue);
+res.dateTimeValue=toDateTimeValue(booleanValue);
+}
+}
+privateclassBooleanArrayStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+Boolean[]booleanValues=(Boolean[])value;
+res.booleanValues=booleanValues;
+for(BooleanbooleanValue:booleanValues){
+res.longValues.add(toLongValue(booleanValue));
+res.decimalValues.add(toDecimalValue(booleanValue));
+res.stringValues.add(toStringValue(booleanValue));
+res.dateValues.add(toDateValue(booleanValue));
+res.dateTimeValues.add(toDateTimeValue(booleanValue));
+}
+}
+}
+privateclassDateStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+DatedateValue=(Date)value;
+res.longValue=toLongValue(dateValue);
+res.decimalValue=toDecimalValue(dateValue);
+res.stringValue=toStringValue(dateValue);
+res.booleanValue=toBooleanValue(dateValue);
+res.dateValue=dateValue;
+res.dateTimeValue=toDateTimeValue(dateValue);
+}
+}
+privateclassDateArrayStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+Date[]dateValues=(Date[])value;
+res.dateValues=dateValues;
+for(DatedateValue:dateValues){
+res.longValues.add(toLongValue(dateValue));
+res.decimalValues.add(toDecimalValue(dateValue));
+res.stringValues.add(toStringValue(dateValue));
+res.booleanValues.add(toBooleanValue(dateValue));
+res.dateTimeValues.add(toDateTimeValue(dateValue));
+}
+}
+}
+privateclassDateTimeStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+DateTimedateTimeValue=(DateTime)value;
+res.longValue=toLongValue(dateTimeValue);
+res.decimalValue=toDecimalValue(dateTimeValue);
+res.stringValue=toStringValue(dateTimeValue);
+res.booleanValue=toBooleanValue(dateTimeValue);
+res.dateValue=toDateValue(dateTimeValue);
+res.dateTimeValue=dateTimeValue;
+}
+}
+privateclassDateTimeArrayStrategyimplementsBindingParamStrategy{
+publicvoidexecute(Objectvalue,Responseres){
+DateTime[]dateTimeValues=(DateTime[])value;
+res.dateTimeValues=dateTimeValues;
+for(DateTimedateTimeValue:dateTimeValues){
+res.longValues.add(toLongValue(dateTimeValue));
+res.decimalValues.add(toDecimalValue(dateTimeValue));
+res.stringValues.add(toStringValue(dateTimeValue));
+res.booleanValues.add(toBooleanValue(dateTimeValue));
+res.dateValues.add(toDateValue(dateTimeValue));
+}
+}