--- backup/classes\di_BindingParam.cls
+++ refactored/classes\di_BindingParam.cls
@@ -127,0 +128,180 @@
+privateinterfaceConversionStrategy{
+Responseconvert(Objectvalue,Responseresponse);
+}
+privateclassDecimalConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+DecimaldecimalValue=(Decimal)value;
+response.longValue=toLongValue(decimalValue);
+response.decimalValue=decimalValue;
+response.stringValue=toStringValue(decimalValue);
+response.booleanValue=toBooleanValue(decimalValue);
+response.dateValue=toDateValue(decimalValue);
+response.dateTimeValue=toDateTimeValue(decimalValue);
+returnresponse;
+}
+}
+privateclassDecimalArrayConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+Decimal[]decimalValues=(Decimal[])value;
+response.decimalValues=decimalValues;
+for(DecimaldecimalValue:decimalValues){
+response.longValues.add(toLongValue(decimalValue));
+response.stringValues.add(toStringValue(decimalValue));
+response.booleanValues.add(toBooleanValue(decimalValue));
+response.dateValues.add(toDateValue(decimalValue));
+response.dateTimeValues.add(toDateTimeValue(decimalValue));
+}
+returnresponse;
+}
+}
+privateclassStringConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+StringstringValue=(String)value;
+response.longValue=toLongValue(stringValue);
+response.decimalValue=toDecimalValue(stringValue);
+response.stringValue=stringValue;
+response.booleanValue=toBooleanValue(stringValue);
+response.dateValue=toDateValue(stringValue);
+response.dateTimeValue=toDateTimeValue(stringValue);
+returnresponse;
+}
+}
+privateclassStringArrayConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+String[]stringValues=(String[])value;
+response.stringValues=stringValues;
+for(StringstringValue:stringValues){
+response.longValues.add(toLongValue(stringValue));
+response.decimalValues.add(toDecimalValue(stringValue));
+response.booleanValues.add(toBooleanValue(stringValue));
+response.dateValues.add(toDateValue(stringValue));
+response.dateTimeValues.add(toDateTimeValue(stringValue));
+}
+returnresponse;
+}
+}
+privateclassBooleanConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+BooleanbooleanValue=(Boolean)value;
+response.longValue=toLongValue(booleanValue);
+response.decimalValue=toDecimalValue(booleanValue);
+response.stringValue=toStringValue(booleanValue);
+response.booleanValue=booleanValue;
+response.dateValue=toDateValue(booleanValue);
+response.dateTimeValue=toDateTimeValue(booleanValue);
+returnresponse;
+}
+}
+privateclassBooleanArrayConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+Boolean[]booleanValues=(Boolean[])value;
+response.booleanValues=booleanValues;
+for(BooleanbooleanValue:booleanValues){
+response.longValues.add(toLongValue(booleanValue));
+response.decimalValues.add(toDecimalValue(booleanValue));
+response.stringValues.add(toStringValue(booleanValue));
+response.dateValues.add(toDateValue(booleanValue));
+response.dateTimeValues.add(toDateTimeValue(booleanValue));
+}
+returnresponse;
+}
+}
+privateclassDateConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+DatedateValue=(Date)value;
+response.longValue=toLongValue(dateValue);
+response.decimalValue=toDecimalValue(dateValue);
+response.stringValue=toStringValue(dateValue);
+response.booleanValue=toBooleanValue(dateValue);
+response.dateValue=dateValue;
+response.dateTimeValue=toDateTimeValue(dateValue);
+returnresponse;
+}
+}
+privateclassDateArrayConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+Date[]dateValues=(Date[])value;
+response.dateValues=dateValues;
+for(DatedateValue:dateValues){
+response.longValues.add(toLongValue(dateValue));
+response.decimalValues.add(toDecimalValue(dateValue));
+response.stringValues.add(toStringValue(dateValue));
+response.booleanValues.add(toBooleanValue(dateValue));
+response.dateTimeValues.add(toDateTimeValue(dateValue));
+}
+returnresponse;
+}
+}
+privateclassDateTimeConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+DateTimedateTimeValue=(DateTime)value;
+response.longValue=toLongValue(dateTimeValue);
+response.decimalValue=toDecimalValue(dateTimeValue);
+response.stringValue=toStringValue(dateTimeValue);
+response.booleanValue=toBooleanValue(dateTimeValue);
+response.dateValue=toDateValue(dateTimeValue);
+response.dateTimeValue=dateTimeValue;
+returnresponse;
+}
+}
+privateclassDateTimeArrayConversionStrategyimplementsConversionStrategy{
+publicResponseconvert(Objectvalue,Responseresponse){
+DateTime[]dateTimeValues=(DateTime[])value;
+response.dateTimeValues=dateTimeValues;
+for(DateTimedateTimeValue:dateTimeValues){
+response.longValues.add(toLongValue(dateTimeValue));
+response.decimalValues.add(toDecimalValue(dateTimeValue));
+response.stringValues.add(toStringValue(dateTimeValue));
+response.booleanValues.add(toBooleanValue(dateTimeValue));
+response.dateValues.add(toDateValue(dateTimeValue));
+}
+returnresponse;
+}
+}
+privatestaticMap<Type,ConversionStrategy>STRATEGIES=newMap<Type,ConversionStrategy>{
+Decimal.class=>newDecimalConversionStrategy(),
+Decimal[].class=>newDecimalArrayConversionStrategy(),
+String.class=>newStringConversionStrategy(),
+String[].class=>newStringArrayConversionStrategy(),
+Boolean.class=>newBooleanConversionStrategy(),
+Boolean[].class=>newBooleanArrayConversionStrategy(),
+Date.class=>newDateConversionStrategy(),
+Date[].class=>newDateArrayConversionStrategy(),
+DateTime.class=>newDateTimeConversionStrategy(),
+DateTime[].class=>newDateTimeArrayConversionStrategy()
+};
+privatestaticList<Response>invokeWithStrategy(List<Request>requests){
+List<Response>responses=newList<Response>();
+for(Requestreq:requests){
+Responseres=newResponse();
+if(parameters!=null){
+Objectvalue=parameters.get(req.paramName);
+if(value!=null){
+TypevalueType=value.getClass();
+if(STRATEGIES.containsKey(valueType)){
+res=STRATEGIES.get(valueType).convert(value,res);
+}
+if(res.longValue==null&&!res.longValues.isEmpty()){res.longValue=res.longValues[0];}
+if(res.decimalValue==null&&!res.decimalValues.isEmpty()){res.decimalValue=res.decimalValues[0];}
+if(res.stringValue==null&&!res.stringValues.isEmpty()){res.stringValue=res.stringValues[0];}
+if(res.booleanValue==null&&!res.booleanValues.isEmpty()){res.booleanValue=res.booleanValues[0];}
+if(res.dateValue==null&&!res.dateValues.isEmpty()){res.dateValue=res.dateValues[0];}
+if(res.dateTimeValue==null&&!res.dateTimeValues.isEmpty()){res.dateTimeValue=res.dateTimeValues[0];}
+if(res.longValue!=null&&res.longValues.isEmpty()){res.longValues.add(res.longValue);}
+if(res.decimalValue!=null&&res.decimalValues.isEmpty()){res.decimalValues.add(res.decimalValue);}
+if(res.stringValue!=null&&res.stringValues.isEmpty()){res.stringValues.add(res.stringValue);}
+if(res.booleanValue!=null&&res.booleanValues.isEmpty()){res.booleanValues.add(res.booleanValue);}
+if(res.dateValue!=null&&res.dateValues.isEmpty()){res.dateValues.add(res.dateValue);}
+if(res.dateTimeValue!=null&&res.dateTimeValues.isEmpty()){res.dateTimeValues.add(res.dateTimeValue);}
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
+}
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
+}
+System.debug('paramName='+req);
+System.debug(res);
+responses.add(res);
+}
+returnresponses;
+}