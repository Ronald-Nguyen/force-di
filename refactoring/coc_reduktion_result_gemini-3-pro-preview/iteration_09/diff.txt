--- backup/classes\di_Binding.cls
+++ refactored/classes\di_Binding.cls
@@ -28 +28,2 @@
-}elseif(newInstance==true){
+}
+if(newInstance==true){
@@ -30 +31,2 @@
-}elseif(Injected==null){
+}
+if(Injected==null){
@@ -88,5 +90,5 @@
-for(IntegercurrentBindingsIndex=0;currentBindingsIndex<this.bindings.size();currentBindingsIndex++)
-{
-if(isBindingMatchByFilteringCriteria(this.bindings[currentBindingsIndex]))
-{
-this.bindings[currentBindingsIndex]=di_Binding.newInstance(di_Binding.BindingType.Apex,this.developerName,this.bindingObject,null,mockType,null);
+for(Integeri=0;i<this.bindings.size();i++)
+{
+if(isBindingMatchByFilteringCriteria(this.bindings[i]))
+{
+this.bindings[i]=di_Binding.newInstance(di_Binding.BindingType.Apex,this.developerName,this.bindingObject,null,mockType,null);
@@ -102,26 +104,18 @@
-BooleanisMatch=false;
-if(String.isNotBlank(this.developerName)&&this.bindingObject!=null)
-{
-if((this.developerName.equalsIgnoreCase(bind.DeveloperName)
-||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName)
-)
-&&this.bindingObject==bind.BindingObject)
-{
-isMatch=true;
-}
-}
-else{
-if(String.isNotBlank(this.developerName)
-&&(this.developerName.equalsIgnoreCase(bind.DeveloperName)
-||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName)
-)
-)
-{
-isMatch=true;
-}
-elseif(this.bindingObject!=null&&bind.BindingObject==this.bindingObject)
-{
-isMatch=true;
-}
-}
-returnisMatch;
+BooleannameMatch=isNameMatch(bind);
+if(String.isNotBlank(this.developerName)&&this.bindingObject!=null){
+returnnameMatch&&(this.bindingObject==bind.BindingObject);
+}
+if(String.isNotBlank(this.developerName)){
+returnnameMatch;
+}
+if(this.bindingObject!=null){
+returnthis.bindingObject==bind.BindingObject;
+}
+returnfalse;
+}
+privateBooleanisNameMatch(di_Bindingbind){
+if(String.isBlank(this.developerName)){
+returnfalse;
+}
+returnthis.developerName.equalsIgnoreCase(bind.DeveloperName)
+||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName);
@@ -131,2 +125,3 @@
-if(this.bindings==null)
-{
+if(this.bindings!=null){
+return;
+}
@@ -148 +142,0 @@
-}
@@ -152,3 +146,2 @@
-if((di_PlatformCache.isStoringBindingInPlatformCache()&&bindingsAreRequired&&matchedBindings.isEmpty())
-||!di_PlatformCache.isStoringBindingInPlatformCache()
-)
+BooleancacheEnabled=di_PlatformCache.isStoringBindingInPlatformCache();
+if(!cacheEnabled||(bindingsAreRequired&&matchedBindings.isEmpty()))
@@ -207,2 +200,3 @@
-if(ToinstanceofString)
-{
+if(!(ToinstanceofString)){
+returnTo;
+}
@@ -210 +204 @@
-TypetoType=NameSpacePrefix==null?Type.forName(className):Type.forName(NamespacePrefix,className);
+TypetoType=NamespacePrefix==null?Type.forName(className):Type.forName(NamespacePrefix,className);
@@ -221 +215 @@
-elseif(params!=null)
+if(params!=null)
@@ -227,2 +220,0 @@
-returnTo;
-}
@@ -234,2 +226,3 @@
-if(ToinstanceofString)
-{
+if(!(ToinstanceofString)){
+returnTo;
+}
@@ -250,2 +242,0 @@
-returnTo;
-}
@@ -264,2 +255,3 @@
-if(ToinstanceofString)
-{
+if(!(ToinstanceofString)){
+returnTo;
+}
@@ -267,10 +259,5 @@
-if(paramsinstanceofMap<String,Object>)
-{
-returnnewdi_Flow(Flow.Interview.createInterview(flowName,(Map<String,Object>)params));
-}
-returnnewdi_Flow(Flow.Interview.createInterview(flowName,newMap<String,Object>()));
-}
-returnTo;
-}
-}
-}
+Map<String,Object>inputParams=(paramsinstanceofMap<String,Object>)?(Map<String,Object>)params:newMap<String,Object>();
+returnnewdi_Flow(Flow.Interview.createInterview(flowName,inputParams));
+}
+}
+}

--- backup/classes\di_BindingParam.cls
+++ refactored/classes\di_BindingParam.cls
@@ -3,3 +3 @@
-@InvocableMethod(
-label='GetValue'
-)
+@InvocableMethod(label='GetValue')
@@ -10,0 +9,11 @@
+processRequest(req,res);
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
+}
+System.debug('paramName='+req);
+System.debug(res);
+responses.add(res);
+}
+returnresponses;
+}
+privatestaticvoidprocessRequest(Requestreq,Responseres){
@@ -12,0 +22,7 @@
+mapValueToResponse(res,value);
+synchronizeResponseFields(res);
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
+}
+}
+privatestaticvoidmapValueToResponse(Responseres,Objectvalue){
@@ -14,7 +30 @@
-DecimaldecimalValue=(Decimal)value;
-res.longValue=toLongValue(decimalValue);
-res.decimalValue=decimalValue;
-res.stringValue=toStringValue(decimalValue);
-res.booleanValue=toBooleanValue(decimalValue);
-res.dateValue=toDateValue(decimalValue);
-res.dateTimeValue=toDateTimeValue(decimalValue);
+populateFromDecimal(res,(Decimal)value);
@@ -22,9 +32 @@
-Decimal[]decimalValues=(Decimal[])value;
-res.decimalValues=decimalValues;
-for(DecimaldecimalValue:decimalValues){
-res.longValues.add(toLongValue(decimalValue));
-res.stringValues.add(toStringValue(decimalValue));
-res.booleanValues.add(toBooleanValue(decimalValue));
-res.dateValues.add(toDateValue(decimalValue));
-res.dateTimeValues.add(toDateTimeValue(decimalValue));
-}
+populateFromDecimalArray(res,(Decimal[])value);
@@ -32,7 +34 @@
-StringstringValue=(String)value;
-res.longValue=toLongValue(stringValue);
-res.decimalValue=toDecimalValue(stringValue);
-res.stringValue=stringValue;
-res.booleanValue=toBooleanValue(stringValue);
-res.dateValue=toDateValue(stringValue);
-res.dateTimeValue=toDateTimeValue(stringValue);
+populateFromString(res,(String)value);
@@ -40,9 +36 @@
-String[]stringValues=(String[])value;
-res.stringValues=stringValues;
-for(StringstringValue:stringValues){
-res.longValues.add(toLongValue(stringValue));
-res.decimalValues.add(toDecimalValue(stringValue));
-res.booleanValues.add(toBooleanValue(stringValue));
-res.dateValues.add(toDateValue(stringValue));
-res.dateTimeValues.add(toDateTimeValue(stringValue));
-}
+populateFromStringArray(res,(String[])value);
@@ -50,7 +38 @@
-BooleanbooleanValue=(Boolean)value;
-res.longValue=toLongValue(booleanValue);
-res.decimalValue=toDecimalValue(booleanValue);
-res.stringValue=toStringValue(booleanValue);
-res.booleanValue=booleanValue;
-res.dateValue=toDateValue(booleanValue);
-res.dateTimeValue=toDateTimeValue(booleanValue);
+populateFromBoolean(res,(Boolean)value);
@@ -58,9 +40 @@
-Boolean[]booleanValues=(Boolean[])value;
-res.booleanValues=booleanValues;
-for(BooleanbooleanValue:booleanValues){
-res.longValues.add(toLongValue(booleanValue));
-res.decimalValues.add(toDecimalValue(booleanValue));
-res.stringValues.add(toStringValue(booleanValue));
-res.dateValues.add(toDateValue(booleanValue));
-res.dateTimeValues.add(toDateTimeValue(booleanValue));
-}
+populateFromBooleanArray(res,(Boolean[])value);
@@ -68,7 +42 @@
-DatedateValue=(Date)value;
-res.longValue=toLongValue(dateValue);
-res.decimalValue=toDecimalValue(dateValue);
-res.stringValue=toStringValue(dateValue);
-res.booleanValue=toBooleanValue(dateValue);
-res.dateValue=dateValue;
-res.dateTimeValue=toDateTimeValue(dateValue);
+populateFromDate(res,(Date)value);
@@ -76,9 +44 @@
-Date[]dateValues=(Date[])value;
-res.dateValues=dateValues;
-for(DatedateValue:dateValues){
-res.longValues.add(toLongValue(dateValue));
-res.decimalValues.add(toDecimalValue(dateValue));
-res.stringValues.add(toStringValue(dateValue));
-res.booleanValues.add(toBooleanValue(dateValue));
-res.dateTimeValues.add(toDateTimeValue(dateValue));
-}
+populateFromDateArray(res,(Date[])value);
@@ -86,7 +46 @@
-DateTimedateTimeValue=(DateTime)value;
-res.longValue=toLongValue(dateTimeValue);
-res.decimalValue=toDecimalValue(dateTimeValue);
-res.stringValue=toStringValue(dateTimeValue);
-res.booleanValue=toBooleanValue(dateTimeValue);
-res.dateValue=toDateValue(dateTimeValue);
-res.dateTimeValue=dateTimeValue;
+populateFromDateTime(res,(DateTime)value);
@@ -94,10 +48,94 @@
-DateTime[]dateTimeValues=(DateTime[])value;
-res.dateTimeValues=dateTimeValues;
-for(DateTimedateTimeValue:dateTimeValues){
-res.longValues.add(toLongValue(dateTimeValue));
-res.decimalValues.add(toDecimalValue(dateTimeValue));
-res.stringValues.add(toStringValue(dateTimeValue));
-res.booleanValues.add(toBooleanValue(dateTimeValue));
-res.dateValues.add(toDateValue(dateTimeValue));
-}
-}
+populateFromDateTimeArray(res,(DateTime[])value);
+}
+}
+privatestaticvoidpopulateFromDecimal(Responseres,Decimalv){
+res.longValue=toLongValue(v);
+res.decimalValue=v;
+res.stringValue=toStringValue(v);
+res.booleanValue=toBooleanValue(v);
+res.dateValue=toDateValue(v);
+res.dateTimeValue=toDateTimeValue(v);
+}
+privatestaticvoidpopulateFromDecimalArray(Responseres,Decimal[]vs){
+res.decimalValues=vs;
+for(Decimalv:vs){
+res.longValues.add(toLongValue(v));
+res.stringValues.add(toStringValue(v));
+res.booleanValues.add(toBooleanValue(v));
+res.dateValues.add(toDateValue(v));
+res.dateTimeValues.add(toDateTimeValue(v));
+}
+}
+privatestaticvoidpopulateFromString(Responseres,Stringv){
+res.longValue=toLongValue(v);
+res.decimalValue=toDecimalValue(v);
+res.stringValue=v;
+res.booleanValue=toBooleanValue(v);
+res.dateValue=toDateValue(v);
+res.dateTimeValue=toDateTimeValue(v);
+}
+privatestaticvoidpopulateFromStringArray(Responseres,String[]vs){
+res.stringValues=vs;
+for(Stringv:vs){
+res.longValues.add(toLongValue(v));
+res.decimalValues.add(toDecimalValue(v));
+res.booleanValues.add(toBooleanValue(v));
+res.dateValues.add(toDateValue(v));
+res.dateTimeValues.add(toDateTimeValue(v));
+}
+}
+privatestaticvoidpopulateFromBoolean(Responseres,Booleanv){
+res.longValue=toLongValue(v);
+res.decimalValue=toDecimalValue(v);
+res.stringValue=toStringValue(v);
+res.booleanValue=v;
+res.dateValue=toDateValue(v);
+res.dateTimeValue=toDateTimeValue(v);
+}
+privatestaticvoidpopulateFromBooleanArray(Responseres,Boolean[]vs){
+res.booleanValues=vs;
+for(Booleanv:vs){
+res.longValues.add(toLongValue(v));
+res.decimalValues.add(toDecimalValue(v));
+res.stringValues.add(toStringValue(v));
+res.dateValues.add(toDateValue(v));
+res.dateTimeValues.add(toDateTimeValue(v));
+}
+}
+privatestaticvoidpopulateFromDate(Responseres,Datev){
+res.longValue=toLongValue(v);
+res.decimalValue=toDecimalValue(v);
+res.stringValue=toStringValue(v);
+res.booleanValue=toBooleanValue(v);
+res.dateValue=v;
+res.dateTimeValue=toDateTimeValue(v);
+}
+privatestaticvoidpopulateFromDateArray(Responseres,Date[]vs){
+res.dateValues=vs;
+for(Datev:vs){
+res.longValues.add(toLongValue(v));
+res.decimalValues.add(toDecimalValue(v));
+res.stringValues.add(toStringValue(v));
+res.booleanValues.add(toBooleanValue(v));
+res.dateTimeValues.add(toDateTimeValue(v));
+}
+}
+privatestaticvoidpopulateFromDateTime(Responseres,DateTimev){
+res.longValue=toLongValue(v);
+res.decimalValue=toDecimalValue(v);
+res.stringValue=toStringValue(v);
+res.booleanValue=toBooleanValue(v);
+res.dateValue=toDateValue(v);
+res.dateTimeValue=v;
+}
+privatestaticvoidpopulateFromDateTimeArray(Responseres,DateTime[]vs){
+res.dateTimeValues=vs;
+for(DateTimev:vs){
+res.longValues.add(toLongValue(v));
+res.decimalValues.add(toDecimalValue(v));
+res.stringValues.add(toStringValue(v));
+res.booleanValues.add(toBooleanValue(v));
+res.dateValues.add(toDateValue(v));
+}
+}
+privatestaticvoidsynchronizeResponseFields(Responseres){
@@ -116,11 +153,0 @@
-}else{
-System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
-}
-}else{
-System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
-}
-System.debug('paramName='+req);
-System.debug(res);
-responses.add(res);
-}
-returnresponses;
@@ -213,4 +240 @@
-@InvocableVariable(
-label='ParameterName'
-required=true
-)
+@InvocableVariable(label='ParameterName'required=true)
@@ -220,4 +244 @@
-@InvocableVariable(
-label='Number'
-description='Wholenumber(nodecimals)'
-)
+@InvocableVariable(label='Number'description='Wholenumber(nodecimals)')
@@ -225,4 +246 @@
-@InvocableVariable(
-label='Decimal'
-description='Numberthatmayincludedecimalplaces'
-)
+@InvocableVariable(label='Decimal'description='Numberthatmayincludedecimalplaces')
@@ -230,4 +248 @@
-@InvocableVariable(
-label='Text'
-description='Textvalue'
-)
+@InvocableVariable(label='Text'description='Textvalue')
@@ -235,4 +250 @@
-@InvocableVariable(
-label='Boolean'
-description='true/false'
-)
+@InvocableVariable(label='Boolean'description='true/false')
@@ -240,3 +252 @@
-@InvocableVariable(
-label='Date'
-)
+@InvocableVariable(label='Date')
@@ -244,3 +254 @@
-@InvocableVariable(
-label='Date/Time'
-)
+@InvocableVariable(label='Date/Time')
@@ -248,4 +256 @@
-@InvocableVariable(
-label='NumberCollection'
-description='Collectionofwholenumbers'
-)
+@InvocableVariable(label='NumberCollection'description='Collectionofwholenumbers')
@@ -253,4 +258 @@
-@InvocableVariable(
-label='DecimalCollection'
-description='Collectionofnumbersthatmayincludedecimalplaces'
-)
+@InvocableVariable(label='DecimalCollection'description='Collectionofnumbersthatmayincludedecimalplaces')
@@ -258,4 +260 @@
-@InvocableVariable(
-label='TextCollection'
-description='Collectionoftextvalues'
-)
+@InvocableVariable(label='TextCollection'description='Collectionoftextvalues')
@@ -263,4 +262 @@
-@InvocableVariable(
-label='BooleanCollection'
-description='Collectionoftrue/falsevalues'
-)
+@InvocableVariable(label='BooleanCollection'description='Collectionoftrue/falsevalues')
@@ -268,4 +264 @@
-@InvocableVariable(
-label='DateCollection'
-description='Collectionofdatevalues'
-)
+@InvocableVariable(label='DateCollection'description='Collectionofdatevalues')
@@ -273,4 +266 @@
-@InvocableVariable(
-label='Date/TimeCollection'
-description='Collectionofdate/timevalues'
-)
+@InvocableVariable(label='Date/TimeCollection'description='Collectionofdate/timevalues')

--- backup/classes\di_Injector.cls
+++ refactored/classes\di_Injector.cls
@@ -87,2 +87,12 @@
-if(String.isNotBlank(bindingConfig.BindingObject)
-||String.isNotBlank(bindingConfig.BindingObjectAlternate)){
+resolveBindingObject(bindingConfig);
+if(bindingConfig.BindingSequence!=null){
+sequence(Integer.valueOf(bindingConfig.BindingSequence));
+}
+data(bindingConfig);
+to(bindingConfig.To);
+}
+}
+privatevoidresolveBindingObject(di_BindingConfigWrapperbindingConfig){
+if(String.isBlank(bindingConfig.BindingObject)&&String.isBlank(bindingConfig.BindingObjectAlternate)){
+return;
+}
@@ -98,7 +107,0 @@
-if(bindingConfig.BindingSequence!=null){
-sequence(Integer.valueOf(bindingConfig.BindingSequence));
-}
-data(bindingConfig);
-to(bindingConfig.To);
-}
-}

--- backup/classes\di_PlatformCache.cls
+++ refactored/classes\di_PlatformCache.cls
@@ -54,6 +54,7 @@
-Booleanresult=false;
-if(isStoringBindingInPlatformCache())
-{
-Cache.OrgPartitionorgPartition=getPartition();
-if(orgPartition!=null)
-{
+if(!isStoringBindingInPlatformCache()){
+returnfalse;
+}
+Cache.OrgPartitionorgPartition=getPartition();
+if(orgPartition==null){
+returnfalse;
+}
@@ -62,2 +63 @@
-if(orgPartition.contains(theKeyName))
-{
+if(orgPartition.contains(theKeyName)){
@@ -68,2 +68 @@
-try
-{
+try{
@@ -72,2 +71 @@
-catch(cache.Org.OrgCacheExceptionoce)
-{
+catch(cache.Org.OrgCacheExceptionoce){
@@ -77,4 +75 @@
-result=true;
-}
-}
-returnresult;
+returntrue;
@@ -85,4 +80,3 @@
-if(isStoringBindingInPlatformCache()
-&&string.isNotBlank(developerName)
-&&bindingSObjectType!=null)
-{
+if(!isStoringBindingInPlatformCache()||String.isBlank(developerName)||bindingSObjectType==null){
+returnbindings;
+}
@@ -92,2 +86,3 @@
-if(keyIndexBySObjectTypeMap!=null&&orgPartition!=null)
-{
+if(keyIndexBySObjectTypeMap==null||orgPartition==null){
+returnbindings;
+}
@@ -95,8 +90,4 @@
-if(cacheKeys!=null)
-{
-ObjectcachedObject=null;
-for(StringcacheKey:cacheKeys)
-{
-cachedObject=orgPartition.get(cacheKey);
-if(cachedObject!=null)
-{
+if(cacheKeys!=null){
+for(StringcacheKey:cacheKeys){
+ObjectcachedObject=orgPartition.get(cacheKey);
+if(cachedObject!=null){
@@ -104,2 +94,0 @@
-}
-}
@@ -119,2 +108 @@
-try
-{
+try{
@@ -123,2 +111 @@
-catch(Exceptionex)
-{
+catch(Exceptionex){
@@ -134,2 +121 @@
-if(partition!=null)
-{
+if(partition!=null){
@@ -169,2 +155 @@
-try
-{
+try{
@@ -173,2 +158 @@
-catch(Exceptionexcp)
-{
+catch(Exceptionexcp){
@@ -215,2 +199 @@
-if(generatedKeyNames.containsKey(key))
-{
+if(generatedKeyNames.containsKey(key)){
@@ -252,2 +235 @@
-if(doLog)
-{
+if(doLog){