--- backup/classes\di_Binding.cls
+++ refactored/classes\di_Binding.cls
@@ -26 +26 @@
-if(IsProvider){
+if(IsProvider||newInstance==true){
@@ -28,3 +28,2 @@
-}elseif(newInstance==true){
-returnnewInstance(params);
-}elseif(Injected==null){
+}
+if(Injected==null){
@@ -102 +101,2 @@
-BooleanisMatch=false;
+BooleannameMatch=matchesName(bind);
+BooleanobjectMatch=matchesObject(bind);
@@ -105,23 +105,18 @@
-if((this.developerName.equalsIgnoreCase(bind.DeveloperName)
-||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName)
-)
-&&this.bindingObject==bind.BindingObject)
-{
-isMatch=true;
-}
-}
-else{
-if(String.isNotBlank(this.developerName)
-&&(this.developerName.equalsIgnoreCase(bind.DeveloperName)
-||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName)
-)
-)
-{
-isMatch=true;
-}
-elseif(this.bindingObject!=null&&bind.BindingObject==this.bindingObject)
-{
-isMatch=true;
-}
-}
-returnisMatch;
+returnnameMatch&&objectMatch;
+}
+if(String.isNotBlank(this.developerName))
+{
+returnnameMatch;
+}
+if(this.bindingObject!=null)
+{
+returnobjectMatch;
+}
+returnfalse;
+}
+privateBooleanmatchesName(di_Bindingbind){
+returnthis.developerName.equalsIgnoreCase(bind.DeveloperName)
+||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName);
+}
+privateBooleanmatchesObject(di_Bindingbind){
+returnthis.bindingObject==bind.BindingObject;
@@ -131,2 +126,3 @@
-if(this.bindings==null)
-{
+if(this.bindings!=null){
+return;
+}
@@ -144 +139,0 @@
-}
@@ -207,2 +202,4 @@
-if(ToinstanceofString)
-{
+if(!(ToinstanceofString))
+{
+returnTo;
+}
@@ -210 +207 @@
-TypetoType=NameSpacePrefix==null?Type.forName(className):Type.forName(NamespacePrefix,className);
+TypetoType=NamespacePrefix==null?Type.forName(className):Type.forName(NamespacePrefix,className);
@@ -221 +218 @@
-elseif(params!=null)
+if(params!=null)
@@ -227,2 +223,0 @@
-returnTo;
-}
@@ -234,2 +229,4 @@
-if(ToinstanceofString)
-{
+if(!(ToinstanceofString))
+{
+returnTo;
+}
@@ -250,2 +246,0 @@
-returnTo;
-}

--- backup/classes\di_BindingParam.cls
+++ refactored/classes\di_BindingParam.cls
@@ -3,3 +3 @@
-@InvocableMethod(
-label='GetValue'
-)
+@InvocableMethod(label='GetValue')
@@ -10,0 +9,11 @@
+processParameter(req,res);
+}else{
+System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
+}
+System.debug('paramName='+req);
+System.debug(res);
+responses.add(res);
+}
+returnresponses;
+}
+privatestaticvoidprocessParameter(Requestreq,Responseres){
@@ -12 +21,8 @@
-if(value!=null){
+if(value==null){
+System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
+return;
+}
+handleValue(value,res);
+finalizeResponse(res);
+}
+privatestaticvoidhandleValue(Objectvalue,Responseres){
@@ -14,90 +30,131 @@
-DecimaldecimalValue=(Decimal)value;
-res.longValue=toLongValue(decimalValue);
-res.decimalValue=decimalValue;
-res.stringValue=toStringValue(decimalValue);
-res.booleanValue=toBooleanValue(decimalValue);
-res.dateValue=toDateValue(decimalValue);
-res.dateTimeValue=toDateTimeValue(decimalValue);
-}elseif(valueinstanceofDecimal[]){
-Decimal[]decimalValues=(Decimal[])value;
-res.decimalValues=decimalValues;
-for(DecimaldecimalValue:decimalValues){
-res.longValues.add(toLongValue(decimalValue));
-res.stringValues.add(toStringValue(decimalValue));
-res.booleanValues.add(toBooleanValue(decimalValue));
-res.dateValues.add(toDateValue(decimalValue));
-res.dateTimeValues.add(toDateTimeValue(decimalValue));
-}
-}elseif(valueinstanceofString){
-StringstringValue=(String)value;
-res.longValue=toLongValue(stringValue);
-res.decimalValue=toDecimalValue(stringValue);
-res.stringValue=stringValue;
-res.booleanValue=toBooleanValue(stringValue);
-res.dateValue=toDateValue(stringValue);
-res.dateTimeValue=toDateTimeValue(stringValue);
-}elseif(valueinstanceofString[]){
-String[]stringValues=(String[])value;
-res.stringValues=stringValues;
-for(StringstringValue:stringValues){
-res.longValues.add(toLongValue(stringValue));
-res.decimalValues.add(toDecimalValue(stringValue));
-res.booleanValues.add(toBooleanValue(stringValue));
-res.dateValues.add(toDateValue(stringValue));
-res.dateTimeValues.add(toDateTimeValue(stringValue));
-}
-}elseif(valueinstanceofBoolean){
-BooleanbooleanValue=(Boolean)value;
-res.longValue=toLongValue(booleanValue);
-res.decimalValue=toDecimalValue(booleanValue);
-res.stringValue=toStringValue(booleanValue);
-res.booleanValue=booleanValue;
-res.dateValue=toDateValue(booleanValue);
-res.dateTimeValue=toDateTimeValue(booleanValue);
-}elseif(valueinstanceofBoolean[]){
-Boolean[]booleanValues=(Boolean[])value;
-res.booleanValues=booleanValues;
-for(BooleanbooleanValue:booleanValues){
-res.longValues.add(toLongValue(booleanValue));
-res.decimalValues.add(toDecimalValue(booleanValue));
-res.stringValues.add(toStringValue(booleanValue));
-res.dateValues.add(toDateValue(booleanValue));
-res.dateTimeValues.add(toDateTimeValue(booleanValue));
-}
-}elseif(valueinstanceofDate){
-DatedateValue=(Date)value;
-res.longValue=toLongValue(dateValue);
-res.decimalValue=toDecimalValue(dateValue);
-res.stringValue=toStringValue(dateValue);
-res.booleanValue=toBooleanValue(dateValue);
-res.dateValue=dateValue;
-res.dateTimeValue=toDateTimeValue(dateValue);
-}elseif(valueinstanceofDate[]){
-Date[]dateValues=(Date[])value;
-res.dateValues=dateValues;
-for(DatedateValue:dateValues){
-res.longValues.add(toLongValue(dateValue));
-res.decimalValues.add(toDecimalValue(dateValue));
-res.stringValues.add(toStringValue(dateValue));
-res.booleanValues.add(toBooleanValue(dateValue));
-res.dateTimeValues.add(toDateTimeValue(dateValue));
-}
-}elseif(valueinstanceofDateTime){
-DateTimedateTimeValue=(DateTime)value;
-res.longValue=toLongValue(dateTimeValue);
-res.decimalValue=toDecimalValue(dateTimeValue);
-res.stringValue=toStringValue(dateTimeValue);
-res.booleanValue=toBooleanValue(dateTimeValue);
-res.dateValue=toDateValue(dateTimeValue);
-res.dateTimeValue=dateTimeValue;
-}elseif(valueinstanceofDateTime[]){
-DateTime[]dateTimeValues=(DateTime[])value;
-res.dateTimeValues=dateTimeValues;
-for(DateTimedateTimeValue:dateTimeValues){
-res.longValues.add(toLongValue(dateTimeValue));
-res.decimalValues.add(toDecimalValue(dateTimeValue));
-res.stringValues.add(toStringValue(dateTimeValue));
-res.booleanValues.add(toBooleanValue(dateTimeValue));
-res.dateValues.add(toDateValue(dateTimeValue));
-}
-}
+handleDecimal((Decimal)value,res);
+return;
+}
+if(valueinstanceofDecimal[]){
+handleDecimalArray((Decimal[])value,res);
+return;
+}
+if(valueinstanceofString){
+handleString((String)value,res);
+return;
+}
+if(valueinstanceofString[]){
+handleStringArray((String[])value,res);
+return;
+}
+if(valueinstanceofBoolean){
+handleBoolean((Boolean)value,res);
+return;
+}
+if(valueinstanceofBoolean[]){
+handleBooleanArray((Boolean[])value,res);
+return;
+}
+if(valueinstanceofDate){
+handleDate((Date)value,res);
+return;
+}
+if(valueinstanceofDate[]){
+handleDateArray((Date[])value,res);
+return;
+}
+if(valueinstanceofDateTime){
+handleDateTime((DateTime)value,res);
+return;
+}
+if(valueinstanceofDateTime[]){
+handleDateTimeArray((DateTime[])value,res);
+return;
+}
+}
+privatestaticvoidhandleDecimal(Decimalvalue,Responseres){
+res.longValue=toLongValue(value);
+res.decimalValue=value;
+res.stringValue=toStringValue(value);
+res.booleanValue=toBooleanValue(value);
+res.dateValue=toDateValue(value);
+res.dateTimeValue=toDateTimeValue(value);
+}
+privatestaticvoidhandleDecimalArray(Decimal[]values,Responseres){
+res.decimalValues=values;
+for(Decimalval:values){
+res.longValues.add(toLongValue(val));
+res.stringValues.add(toStringValue(val));
+res.booleanValues.add(toBooleanValue(val));
+res.dateValues.add(toDateValue(val));
+res.dateTimeValues.add(toDateTimeValue(val));
+}
+}
+privatestaticvoidhandleString(Stringvalue,Responseres){
+res.longValue=toLongValue(value);
+res.decimalValue=toDecimalValue(value);
+res.stringValue=value;
+res.booleanValue=toBooleanValue(value);
+res.dateValue=toDateValue(value);
+res.dateTimeValue=toDateTimeValue(value);
+}
+privatestaticvoidhandleStringArray(String[]values,Responseres){
+res.stringValues=values;
+for(Stringval:values){
+res.longValues.add(toLongValue(val));
+res.decimalValues.add(toDecimalValue(val));
+res.booleanValues.add(toBooleanValue(val));
+res.dateValues.add(toDateValue(val));
+res.dateTimeValues.add(toDateTimeValue(val));
+}
+}
+privatestaticvoidhandleBoolean(Booleanvalue,Responseres){
+res.longValue=toLongValue(value);
+res.decimalValue=toDecimalValue(value);
+res.stringValue=toStringValue(value);
+res.booleanValue=value;
+res.dateValue=toDateValue(value);
+res.dateTimeValue=toDateTimeValue(value);
+}
+privatestaticvoidhandleBooleanArray(Boolean[]values,Responseres){
+res.booleanValues=values;
+for(Booleanval:values){
+res.longValues.add(toLongValue(val));
+res.decimalValues.add(toDecimalValue(val));
+res.stringValues.add(toStringValue(val));
+res.dateValues.add(toDateValue(val));
+res.dateTimeValues.add(toDateTimeValue(val));
+}
+}
+privatestaticvoidhandleDate(Datevalue,Responseres){
+res.longValue=toLongValue(value);
+res.decimalValue=toDecimalValue(value);
+res.stringValue=toStringValue(value);
+res.booleanValue=toBooleanValue(value);
+res.dateValue=value;
+res.dateTimeValue=toDateTimeValue(value);
+}
+privatestaticvoidhandleDateArray(Date[]values,Responseres){
+res.dateValues=values;
+for(Dateval:values){
+res.longValues.add(toLongValue(val));
+res.decimalValues.add(toDecimalValue(val));
+res.stringValues.add(toStringValue(val));
+res.booleanValues.add(toBooleanValue(val));
+res.dateTimeValues.add(toDateTimeValue(val));
+}
+}
+privatestaticvoidhandleDateTime(DateTimevalue,Responseres){
+res.longValue=toLongValue(value);
+res.decimalValue=toDecimalValue(value);
+res.stringValue=toStringValue(value);
+res.booleanValue=toBooleanValue(value);
+res.dateValue=toDateValue(value);
+res.dateTimeValue=value;
+}
+privatestaticvoidhandleDateTimeArray(DateTime[]values,Responseres){
+res.dateTimeValues=values;
+for(DateTimeval:values){
+res.longValues.add(toLongValue(val));
+res.decimalValues.add(toDecimalValue(val));
+res.stringValues.add(toStringValue(val));
+res.booleanValues.add(toBooleanValue(val));
+res.dateValues.add(toDateValue(val));
+}
+}
+privatestaticvoidfinalizeResponse(Responseres){
@@ -116,11 +172,0 @@
-}else{
-System.debug(LoggingLevel.WARN,'BindingParam.parameters.get("'+req+'")isnull');
-}
-}else{
-System.debug(LoggingLevel.WARN,'BindingParam.parametersisnull');
-}
-System.debug('paramName='+req);
-System.debug(res);
-responses.add(res);
-}
-returnresponses;

--- backup/classes\di_Injector.cls
+++ refactored/classes\di_Injector.cls
@@ -84,0 +85,4 @@
+configureBinding(bindingConfig);
+}
+}
+privatevoidconfigureBinding(di_BindingConfigWrapperbindingConfig){
@@ -105 +108,0 @@
-}

--- backup/classes\di_InjectorComponentFlowProxyController.cls
+++ refactored/classes\di_InjectorComponentFlowProxyController.cls
@@ -8,6 +8 @@
-Map<Object,Object>oldMap=(Map<Object,Object>)InputVariablesValue;
-Map<String,Object>newMap=newMap<String,Object>();
-for(Objectkey:oldMap.keySet()){
-newMap.put(String.valueOf(key),oldMap.get(key));
-}
-di_BindingParam.parameters=newMap;
+di_BindingParam.parameters=convertInputMap((Map<Object,Object>)InputVariablesValue);
@@ -18,0 +14,4 @@
+privateMap<String,Object>convertInputMap(Map<Object,Object>oldMap){
+Map<String,Object>newMap=newMap<String,Object>();
+for(Objectkey:oldMap.keySet()){
+newMap.put(String.valueOf(key),oldMap.get(key));
@@ -19,0 +19,3 @@
+returnnewMap;
+}
+}

--- backup/classes\di_PlatformCache.cls
+++ refactored/classes\di_PlatformCache.cls
@@ -31,2 +31,4 @@
-if(cacheKeyIndexMap.isEmpty())
-{
+if(!cacheKeyIndexMap.isEmpty())
+{
+returncacheKeyIndexMap;
+}
@@ -49 +50,0 @@
-}
@@ -54,6 +55,7 @@
-Booleanresult=false;
-if(isStoringBindingInPlatformCache())
-{
-Cache.OrgPartitionorgPartition=getPartition();
-if(orgPartition!=null)
-{
+if(!isStoringBindingInPlatformCache()){
+returnfalse;
+}
+Cache.OrgPartitionorgPartition=getPartition();
+if(orgPartition==null){
+returnfalse;
+}
@@ -77,4 +79 @@
-result=true;
-}
-}
-returnresult;
+returntrue;
@@ -85,4 +84,3 @@
-if(isStoringBindingInPlatformCache()
-&&string.isNotBlank(developerName)
-&&bindingSObjectType!=null)
-{
+if(!isStoringBindingInPlatformCache()||String.isBlank(developerName)||bindingSObjectType==null){
+returnbindings;
+}
@@ -108 +105,0 @@
-}
@@ -113,2 +110,3 @@
-if(keys!=null)
-{
+if(keys==null){
+return;
+}
@@ -126 +123,0 @@
-}