--- backup/main\classes\di_Binding.cls
+++ refactored/main\classes\di_Binding.cls
@@ -28 +28,2 @@
-}elseif(newInstance==true){
+}
+if(newInstance){
@@ -30 +31,2 @@
-}elseif(Injected==null){
+}
+if(Injected==null){
@@ -41,2 +43 @@
-StringhashValue=
-(BindingObject!=null)?
+StringhashValue=(BindingObject!=null)?
@@ -85,2 +86 @@
-publicResolverreplaceBindingWith(ObjectmockType)
-{
+publicResolverreplaceBindingWith(ObjectmockType){
@@ -88,5 +88,10 @@
-for(IntegercurrentBindingsIndex=0;currentBindingsIndex<this.bindings.size();currentBindingsIndex++)
-{
-if(isBindingMatchByFilteringCriteria(this.bindings[currentBindingsIndex]))
-{
-this.bindings[currentBindingsIndex]=di_Binding.newInstance(di_Binding.BindingType.Apex,this.developerName,this.bindingObject,null,mockType,null);
+for(IntegercurrentBindingsIndex=0;currentBindingsIndex<this.bindings.size();currentBindingsIndex++){
+if(isBindingMatchByFilteringCriteria(this.bindings[currentBindingsIndex])){
+this.bindings[currentBindingsIndex]=di_Binding.newInstance(
+di_Binding.BindingType.Apex,
+this.developerName,
+this.bindingObject,
+null,
+mockType,
+null
+);
@@ -100,2 +105 @@
-privateBooleanisBindingMatchByFilteringCriteria(di_Bindingbind)
-{
+privateBooleanisBindingMatchByFilteringCriteria(di_Bindingbind){
@@ -103,7 +107,2 @@
-if(String.isNotBlank(this.developerName)&&this.bindingObject!=null)
-{
-if((this.developerName.equalsIgnoreCase(bind.DeveloperName)
-||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName)
-)
-&&this.bindingObject==bind.BindingObject)
-{
+if(String.isNotBlank(this.developerName)&&this.bindingObject!=null){
+if(isDeveloperNameMatch(bind)&&this.bindingObject==bind.BindingObject){
@@ -112,8 +111,2 @@
-}
-else{
-if(String.isNotBlank(this.developerName)
-&&(this.developerName.equalsIgnoreCase(bind.DeveloperName)
-||this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName)
-)
-)
-{
+}else{
+if(isDeveloperNameMatch(bind)||isBindingObjectMatch(bind)){
@@ -122,4 +114,0 @@
-elseif(this.bindingObject!=null&&bind.BindingObject==this.bindingObject)
-{
-isMatch=true;
-}
@@ -129,4 +118,14 @@
-privatevoidloadBindings()
-{
-if(this.bindings==null)
-{
+privateBooleanisDeveloperNameMatch(di_Bindingbind){
+if(String.isBlank(this.developerName)){
+returnfalse;
+}
+returnthis.developerName.equalsIgnoreCase(bind.DeveloperName)||
+this.developerName.equalsIgnoreCase(di_NamespaceClass.CURRENTNAMESPACE+'.'+bind.DeveloperName);
+}
+privateBooleanisBindingObjectMatch(di_Bindingbind){
+returnthis.bindingObject!=null&&bind.BindingObject==this.bindingObject;
+}
+privatevoidloadBindings(){
+if(this.bindings!=null){
+return;
+}
@@ -134,2 +133 @@
-for(di_Modulemodule:modules)
-{
+for(di_Modulemodule:modules){
@@ -136,0 +135,4 @@
+processModuleBindings(module);
+}
+}
+privatevoidprocessModuleBindings(di_Modulemodule){
@@ -138,0 +141,7 @@
+processEmbeddedModule(bind);
+}else{
+this.bindings.add(bind);
+}
+}
+}
+privatevoidprocessEmbeddedModule(di_Bindingbind){
@@ -142,9 +151,2 @@
-}else{
-this.bindings.add(bind);
-}
-}
-}
-}
-}
-publicList<di_Binding>get()
-{
+}
+publicList<di_Binding>get(){
@@ -152,4 +154 @@
-if((di_PlatformCache.isStoringBindingInPlatformCache()&&bindingsAreRequired&&matchedBindings.isEmpty())
-||!di_PlatformCache.isStoringBindingInPlatformCache()
-)
-{
+if(shouldLoadBindingsFromCache(matchedBindings)){
@@ -157,4 +156,13 @@
-for(di_Bindingbind:bindings)
-{
-if(isBindingMatchByFilteringCriteria(bind))
-{
+filterBindings(matchedBindings);
+}
+resetState();
+matchedBindings.sort();
+returnmatchedBindings;
+}
+privateBooleanshouldLoadBindingsFromCache(List<di_Binding>matchedBindings){
+return(di_PlatformCache.isStoringBindingInPlatformCache()&&bindingsAreRequired&&matchedBindings.isEmpty())||
+!di_PlatformCache.isStoringBindingInPlatformCache();
+}
+privatevoidfilterBindings(List<di_Binding>matchedBindings){
+for(di_Bindingbind:bindings){
+if(isBindingMatchByFilteringCriteria(bind)){
@@ -164,0 +173 @@
+privatevoidresetState(){
@@ -167 +175,0 @@
-matchedBindings.sort();
@@ -169 +176,0 @@
-returnmatchedBindings;
@@ -180,2 +187 @@
-ObjectbindingData)
-{
+ObjectbindingData){
@@ -203,6 +209,3 @@
-privateclassApexBindingextendsdi_Binding
-{
-publicoverrideObjectnewInstance(Objectparams)
-{
-if(ToinstanceofString)
-{
+privateclassApexBindingextendsdi_Binding{
+publicoverrideObjectnewInstance(Objectparams){
+if(ToinstanceofString){
@@ -210,3 +213,2 @@
-TypetoType=NameSpacePrefix==null?Type.forName(className):Type.forName(NamespacePrefix,className);
-if(toType==null)
-{
+TypetoType=getTypeForClass(className);
+if(toType==null){
@@ -217,2 +219 @@
-if(IsProvider)
-{
+if(IsProvider){
@@ -221,2 +222 @@
-elseif(params!=null)
-{
+if(params!=null){
@@ -229,7 +229,9 @@
-}
-privateclassVisualForceComponentBindingextendsdi_Binding
-{
-publicoverrideObjectnewInstance(Objectparams)
-{
-if(ToinstanceofString)
-{
+privateTypegetTypeForClass(StringclassName){
+returnNamespacePrefix==null?
+Type.forName(className):
+Type.forName(NamespacePrefix,className);
+}
+}
+privateclassVisualForceComponentBindingextendsdi_Binding{
+publicoverrideObjectnewInstance(Objectparams){
+if(ToinstanceofString){
@@ -237,3 +239,2 @@
-TypetoType=NamespacePrefix==null?Type.forName(className):Type.forName(NamespacePrefix,className);
-if(toType==null)
-{
+TypetoType=getTypeForClass(className);
+if(toType==null){
@@ -244,2 +245 @@
-if(IsProvider)
-{
+if(IsProvider){
@@ -252,14 +252,14 @@
-}
-privateclassLightningComponentBindingextendsdi_Binding
-{
-publicoverrideObjectnewInstance(Objectparams)
-{
-returnTo;
-}
-}
-privateclassFlowBindingextendsdi_Binding
-{
-publicoverrideObjectnewInstance(Objectparams)
-{
-if(ToinstanceofString)
-{
+privateTypegetTypeForClass(StringclassName){
+returnNamespacePrefix==null?
+Type.forName(className):
+Type.forName(NamespacePrefix,className);
+}
+}
+privateclassLightningComponentBindingextendsdi_Binding{
+publicoverrideObjectnewInstance(Objectparams){
+returnTo;
+}
+}
+privateclassFlowBindingextendsdi_Binding{
+publicoverrideObjectnewInstance(Objectparams){
+if(ToinstanceofString){
@@ -267,2 +267 @@
-if(paramsinstanceofMap<String,Object>)
-{
+if(paramsinstanceofMap<String,Object>){

--- backup/main\classes\di_Injector.cls
+++ refactored/main\classes\di_Injector.cls
@@ -87,2 +87,15 @@
-if(String.isNotBlank(bindingConfig.BindingObject)
-||String.isNotBlank(bindingConfig.BindingObjectAlternate)){
+if(shouldBindToObject(bindingConfig)){
+bindObject(bindingConfig);
+}
+if(bindingConfig.BindingSequence!=null){
+sequence(Integer.valueOf(bindingConfig.BindingSequence));
+}
+data(bindingConfig);
+to(bindingConfig.To);
+}
+}
+privateBooleanshouldBindToObject(di_BindingConfigWrapperbindingConfig){
+returnString.isNotBlank(bindingConfig.BindingObject)||
+String.isNotBlank(bindingConfig.BindingObjectAlternate);
+}
+privatevoidbindObject(di_BindingConfigWrapperbindingConfig){
@@ -98,7 +110,0 @@
-if(bindingConfig.BindingSequence!=null){
-sequence(Integer.valueOf(bindingConfig.BindingSequence));
-}
-data(bindingConfig);
-to(bindingConfig.To);
-}
-}

--- backup/main\classes\di_PlatformCache.cls
+++ refactored/main\classes\di_PlatformCache.cls
@@ -1,2 +1 @@
-publicwithsharingclassdi_PlatformCache
-{
+publicwithsharingclassdi_PlatformCache{
@@ -14,7 +13,4 @@
-privatedi_PlatformCache()
-{
-}
-publicstaticdi_PlatformCachegetInstance()
-{
-if(instance==null)
-{
+privatedi_PlatformCache(){
+}
+publicstaticdi_PlatformCachegetInstance(){
+if(instance==null){
@@ -25,13 +21,10 @@
-publicstaticBooleanisStoringBindingInPlatformCache()
-{
-returngetConfig().UsePlatformCacheToStoreBindings__c==null?false:(getConfig().UsePlatformCacheToStoreBindings__c&&getPartition()!=null);
-}
-publicMap<String,Map<Schema.SObjectType,Set<String>>>getCacheKeyIndexMap()
-{
-if(cacheKeyIndexMap.isEmpty())
-{
-try
-{
-Cache.OrgPartitionorgPartition=getPartition();
-if(orgPartition!=null)
-{
+publicstaticBooleanisStoringBindingInPlatformCache(){
+returngetConfig().UsePlatformCacheToStoreBindings__c==null?
+false:
+(getConfig().UsePlatformCacheToStoreBindings__c&&getPartition()!=null);
+}
+publicMap<String,Map<Schema.SObjectType,Set<String>>>getCacheKeyIndexMap(){
+if(cacheKeyIndexMap.isEmpty()){
+try{
+Cache.OrgPartitionorgPartition=getPartition();
+if(orgPartition!=null){
@@ -40,3 +33 @@
-}
-catch(Cache.Org.OrgCacheExceptionex)
-{
+}catch(Cache.Org.OrgCacheExceptionex){
@@ -45,2 +36 @@
-if(cacheKeyIndexMap==null)
-{
+if(cacheKeyIndexMap==null){
@@ -52,2 +42 @@
-publicBooleanaddBindingToPlatformCache(di_Bindingbinding)
-{
+publicBooleanaddBindingToPlatformCache(di_Bindingbinding){
@@ -55,5 +44,3 @@
-if(isStoringBindingInPlatformCache())
-{
-Cache.OrgPartitionorgPartition=getPartition();
-if(orgPartition!=null)
-{
+if(isStoringBindingInPlatformCache()){
+Cache.OrgPartitionorgPartition=getPartition();
+if(orgPartition!=null){
@@ -62,2 +49 @@
-if(orgPartition.contains(theKeyName))
-{
+if(orgPartition.contains(theKeyName)){
@@ -68,2 +54 @@
-try
-{
+try{
@@ -71,3 +56 @@
-}
-catch(cache.Org.OrgCacheExceptionoce)
-{
+}catch(cache.Org.OrgCacheExceptionoce){
@@ -82,2 +65 @@
-publiclist<di_Binding>retrieveBindings(StringdeveloperName,Schema.SObjectTypebindingSObjectType)
-{
+publiclist<di_Binding>retrieveBindings(StringdeveloperName,Schema.SObjectTypebindingSObjectType){
@@ -85,4 +67 @@
-if(isStoringBindingInPlatformCache()
-&&string.isNotBlank(developerName)
-&&bindingSObjectType!=null)
-{
+if(shouldRetrieveFromCache(developerName,bindingSObjectType)){
@@ -92,2 +71 @@
-if(keyIndexBySObjectTypeMap!=null&&orgPartition!=null)
-{
+if(keyIndexBySObjectTypeMap!=null&&orgPartition!=null){
@@ -95,8 +73,4 @@
-if(cacheKeys!=null)
-{
-ObjectcachedObject=null;
-for(StringcacheKey:cacheKeys)
-{
-cachedObject=orgPartition.get(cacheKey);
-if(cachedObject!=null)
-{
+if(cacheKeys!=null){
+for(StringcacheKey:cacheKeys){
+ObjectcachedObject=orgPartition.get(cacheKey);
+if(cachedObject!=null){
@@ -109,0 +84,5 @@
+}
+privateBooleanshouldRetrieveFromCache(StringdeveloperName,Schema.SObjectTypebindingSObjectType){
+returnisStoringBindingInPlatformCache()&&
+string.isNotBlank(developerName)&&
+bindingSObjectType!=null;
@@ -113,2 +92 @@
-if(keys!=null)
-{
+if(keys!=null){
@@ -117,4 +95,2 @@
-for(Stringkey:partition.getKeys())
-{
-try
-{
+for(Stringkey:partition.getKeys()){
+try{
@@ -122,3 +98 @@
-}
-catch(Exceptionex)
-{
+}catch(Exceptionex){
@@ -130,2 +104 @@
-publicstaticSet<String>getPartitionKeys()
-{
+publicstaticSet<String>getPartitionKeys(){
@@ -134,2 +107 @@
-if(partition!=null)
-{
+if(partition!=null){
@@ -141,2 +113 @@
-privatestaticdi_Configurations__cgetConfig()
-{
+privatestaticdi_Configurations__cgetConfig(){
@@ -144,2 +115 @@
-if(config==null)
-{
+if(config==null){
@@ -148,2 +118 @@
-if(di_Configurations__c.SObjectType.getDescribe().isCreateable())
-{
+if(di_Configurations__c.SObjectType.getDescribe().isCreateable()){
@@ -156,2 +125 @@
-privatestaticStringgetPartitionName()
-{
+privatestaticStringgetPartitionName(){
@@ -161,2 +129 @@
-privateIntegergetPartitionTTL()
-{
+privateIntegergetPartitionTTL(){
@@ -166,2 +133 @@
-privatestaticCache.OrgPartitiongetPartition()
-{
+privatestaticCache.OrgPartitiongetPartition(){
@@ -169,2 +135 @@
-try
-{
+try{
@@ -172,3 +137 @@
-}
-catch(Exceptionexcp)
-{
+}catch(Exceptionexcp){
@@ -180,5 +143,3 @@
-privatebooleanpushCacheKeyIndexMapToCache()
-{
-Cache.OrgPartitionorgPartition=getPartition();
-if(orgPartition!=null)
-{
+privatebooleanpushCacheKeyIndexMapToCache(){
+Cache.OrgPartitionorgPartition=getPartition();
+if(orgPartition!=null){
@@ -190,2 +151 @@
-privatevoidaddBindingToKeyIndex(di_Bindingbinding)
-{
+privatevoidaddBindingToKeyIndex(di_Bindingbinding){
@@ -193,2 +153 @@
-if(!getCacheKeyIndexMap().containsKey(workingDeveloperName))
-{
+if(!getCacheKeyIndexMap().containsKey(workingDeveloperName)){
@@ -197,2 +156 @@
-if(!getCacheKeyIndexMap().get(workingDeveloperName).containsKey(binding.bindingObject))
-{
+if(!getCacheKeyIndexMap().get(workingDeveloperName).containsKey(binding.bindingObject)){
@@ -205,6 +163,4 @@
-privateStringconstructKeyName(Schema.SObjectTypebindingSObjectType,StringdeveloperName)
-{
-Stringkey=((bindingSObjectType!=null)?bindingSObjectType.getDescribe().getName().toLowerCase().replaceAll('__',''):'')
-+(String.isBlank(developerName)?'':developerName.toLowerCase().trim());
-if(generatedKeyNames.containsKey(key))
-{
+privateStringconstructKeyName(Schema.SObjectTypebindingSObjectType,StringdeveloperName){
+Stringkey=((bindingSObjectType!=null)?bindingSObjectType.getDescribe().getName().toLowerCase().replaceAll('__',''):'')+
+(String.isBlank(developerName)?'':developerName.toLowerCase().trim());
+if(generatedKeyNames.containsKey(key)){
@@ -219,2 +175 @@
-privateStringgetKeyName(StringdeveloperName,Schema.SObjectTypebindingSObjectType)
-{
+privateStringgetKeyName(StringdeveloperName,Schema.SObjectTypebindingSObjectType){
@@ -224,2 +179 @@
-privateStringgetKeyName(di_Bindingbinding)
-{
+privateStringgetKeyName(di_Bindingbinding){
@@ -229,2 +183 @@
-privateStringgetKeyIndexName()
-{
+privateStringgetKeyIndexName(){
@@ -234,2 +187 @@
-privatestaticBooleanlog(Exceptionexcp)
-{
+privatestaticBooleanlog(Exceptionexcp){
@@ -243,2 +195 @@
-privatestaticBooleanlog(Stringmessage)
-{
+privatestaticBooleanlog(Stringmessage){
@@ -246,2 +197 @@
-if(doLog)
-{
+if(doLog){